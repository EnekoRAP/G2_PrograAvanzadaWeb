@{
    ViewData["Title"] = "Registro";
}

<link href="~/css/customregistro.css" rel="stylesheet" />
<div class="pantalla-centro">
    <div class="contenedor-todo">
        <!-- TÍTULO EXTERNO -->
        <h1 class="titulo-externo">Realizar Pago Parcial</h1>

        <!-- TARJETA FORMULARIO -->
        <div class="tarjeta-formulario">
            <form id="formAbono" method="post" action="/Abonos/RegistrarAbono">
                <div class="grupo-campo">
                    <label for="compraId">Compra</label>
                    <select id="compraId" name="CompraId" required>
                        <option value="">-- Seleccione una compra pendiente --</option>
                        <option value="1">Compra #001</option>
                        <option value="2">Compra #002</option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label for="saldoAnterior">Saldo Anterior</label>
                    <input type="text" id="saldoAnterior" name="SaldoAnterior" readonly />
                </div>

                <div class="grupo-campo">
                    <label for="abono">Abono</label>
                    <input type="number" id="abono" name="Abono" min="0.01" step="0.01" required />
                    <div class="mensaje-error" id="errorMsg">El abono no puede ser mayor al saldo anterior.</div>
                </div>

                <div class="boton-derecha">
                    <button type="submit" class="btn-abonar">Abonar</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#compraId').change(function () {
                let compraId = $(this).val();
                let saldosSimulados = { 1: 5000, 2: 3200 };
                $('#saldoAnterior').val(saldosSimulados[compraId] || '');
            });

            $('#formAbono').submit(function (e) {
                let saldo = parseFloat($('#saldoAnterior').val());
                let abono = parseFloat($('#abono').val());

                if (abono > saldo) {
                    e.preventDefault();
                    $('#abono').addClass('campo-invalido');
                    $('#errorMsg').show();
                } else {
                    $('#abono').removeClass('campo-invalido');
                    $('#errorMsg').hide();
                }
            });
        });
    </script>
}